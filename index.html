<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UOPI Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #1a202c;
            color: white;
        }
        
        .login-page {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #1a202c;
        }
        
        .login-card {
            background: #2d3748;
            padding: 2rem;
            border-radius: 10px;
            width: 300px;
            text-align: center;
        }
        
        .login-title {
            color: #4299e1;
            margin-bottom: 2rem;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
            text-align: left;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #4a5568;
            border-radius: 5px;
            background: #1a202c;
            color: white;
            box-sizing: border-box;
        }
        
        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
        }
        
        .btn:hover {
            background: #3182ce;
        }
        
        .error {
            color: #f56565;
            margin-top: 1rem;
            display: none;
        }
        
        .dashboard {
            display: none;
            min-height: 100vh;
        }
        
        .dashboard.active {
            display: flex;
        }
        
        .sidebar {
            width: 250px;
            background: #2d3748;
            padding: 1rem;
            border-right: 1px solid #4a5568;
        }
        
        .sidebar h2 {
            color: #4299e1;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .nav-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .nav-item:hover,
        .nav-item.active {
            background: #4a5568;
            color: #4299e1;
        }
        
        .main-content {
            flex: 1;
            padding: 2rem;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #4a5568;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logout-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .card {
            background: #2d3748;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
        }
        
        .card:hover {
            background: #4a5568;
        }
        
        .card-title {
            color: #a0aec0;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: bold;
            color: #fbb924;
        }
        
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .module {
            background: #2d3748;
            border-radius: 10px;
            padding: 1.5rem;
        }
        
        .module h3 {
            color: #4299e1;
            margin-bottom: 1rem;
        }
        
        .module-btn {
            background: #38a169;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
        }
        
        .module-btn:hover {
            background: #2f855a;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #2d3748;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            color: #4299e1;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }
        
        .btn-secondary {
            background: #718096;
        }
        
        .btn-secondary:hover {
            background: #4a5568;
        }
        
        .table {
            width: 100%;
            background: #2d3748;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            background: #4a5568;
            padding: 1rem;
            text-align: left;
            color: #4299e1;
        }
        
        .table td {
            padding: 1rem;
            border-bottom: 1px solid #4a5568;
        }
        
        .table tbody tr:hover {
            background: #4a5568;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #38a169;
            color: white;
            padding: 1rem;
            border-radius: 5px;
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .forms-list {
            background: #2d3748;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .form-item {
            background: #4a5568;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Notifica -->
    <div id="notification" class="notification"></div>

    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-card">
            <h2 class="login-title">üî∞ UOPI Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Username:</label>
                    <input type="text" class="form-input" id="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password:</label>
                    <input type="password" class="form-input" id="password" required>
                </div>
                <button type="submit" class="btn">Accedi</button>
                <div id="loginError" class="error">Credenziali non valide</div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="sidebar">
            <h2>üî∞ UOPI</h2>
            <div class="nav-item active" data-section="home">üè† Dashboard</div>
            <div class="nav-item" data-section="operators">üëÆ Operatori</div>
            <div class="nav-item" data-section="modules">üìù Moduli</div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="user-info">
                    <span id="userName">Admin UOPI</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
            
            <!-- Home Section -->
            <div id="home" class="section active">
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-title">Operatori</div>
                        <div class="card-value" id="operatorsCount">0</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Moduli</div>
                        <div class="card-value" id="modulesCount">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Operators Section -->
            <div id="operators" class="section">
                <div style="margin-bottom: 2rem;">
                    <button class="btn" onclick="openModal('addOperator')">+ Aggiungi Operatore</button>
                </div>
                <div class="table">
                    <table>
                        <thead>
                            <tr>
                                <th>Matricola</th>
                                <th>Nome</th>
                                <th>Grado</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="operatorsTable">
                            <tr>
                                <td colspan="4" style="text-align: center;">Nessun operatore</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Modules Section -->
            <div id="modules" class="section">
                <div class="modules-grid">
                    <div class="module">
                        <h3>üöÅ Attivazione UOPI</h3>
                        <p>Messaggio di attivazione unit√† speciale</p>
                        <button class="module-btn" onclick="openModal('activateUopi')">Compila</button>
                    </div>
                    <div class="module">
                        <h3>üöî Attivazione Pattuglie</h3>
                        <p>Gestione pattuglie operative</p>
                        <button class="module-btn" onclick="openModal('activatePatrol')">Compila</button>
                    </div>
                    <div class="module">
                        <h3>üèÅ Disattivazione UOPI</h3>
                        <p>Concludi operazione</p>
                        <button class="module-btn" onclick="openModal('deactivateUopi')">Compila</button>
                    </div>
                    <div class="module">
                        <h3>üìã Istanza Attivazione</h3>
                        <p>Richiedi attivazione</p>
                        <button class="module-btn" onclick="openModal('requestActivation')">Compila</button>
                    </div>
                </div>
                
                <div class="forms-list">
                    <h3>üìä Moduli Registrati</h3>
                    <div id="modulesList">
                        <p style="text-align: center; color: #a0aec0;">Nessun modulo registrato</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Add Operator -->
    <div id="modalAddOperator" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Nuovo Operatore</h3>
            <form id="operatorForm">
                <div class="form-group">
                    <label class="form-label">Nome:</label>
                    <input type="text" class="form-input" name="nome" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Cognome:</label>
                    <input type="text" class="form-input" name="cognome" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Grado:</label>
                    <input type="text" class="form-input" name="grado" required>
                </div>
            </form>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Annulla</button>
                <button class="btn" onclick="saveOperator()">Salva</button>
            </div>
        </div>
    </div>

    <!-- Modal Activate UOPI -->
    <div id="modalActivateUopi" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">üöÅ Attivazione UOPI</h3>
            <form id="activateUopiForm">
                <div class="form-group">
                    <label class="form-label">Autorizzato da:</label>
                    <select class="form-input" name="autorizzato" required>
                        <option value="">Seleziona</option>
                        <option value="Commissario">Commissario</option>
                        <option value="Questore">Questore</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Coordinatore:</label>
                    <input type="text" class="form-input" name="coordinatore" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Operatore Contrattazione:</label>
                    <input type="text" class="form-input" name="operatore" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo Intervento:</label>
                    <select class="form-input" name="tipo" required>
                        <option value="">Seleziona</option>
                        <option value="Rapina">Rapina in corso</option>
                        <option value="Sequestro">Sequestro persona</option>
                        <option value="Terrorismo">Terrorismo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Operatori Coinvolti:</label>
                    <textarea class="form-input" name="operatori" rows="3" required></textarea>
                </div>
            </form>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Annulla</button>
                <button class="btn" onclick="saveModule('activateUopi')">Attiva UOPI</button>
            </div>
        </div>
    </div>

    <!-- Modal Activate Patrol -->
    <div id="modalActivatePatrol" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">üöî Attivazione Pattuglie</h3>
            <form id="activatePatrolForm">
                <div class="form-group">
                    <label class="form-label">Gestito da:</label>
                    <input type="text" class="form-input" name="gestore" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo Intervento:</label>
                    <select class="form-input" name="tipo" required>
                        <option value="">Seleziona</option>
                        <option value="Pattugliamento">Pattugliamento</option>
                        <option value="Emergenza">Emergenza</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Veicolo:</label>
                    <input type="text" class="form-input" name="veicolo" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Operatori:</label>
                    <textarea class="form-input" name="operatori" rows="3" required></textarea>
                </div>
            </form>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Annulla</button>
                <button class="btn" onclick="saveModule('activatePatrol')">Attiva</button>
            </div>
        </div>
    </div>

    <!-- Modal Deactivate UOPI -->
    <div id="modalDeactivateUopi" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">üèÅ Disattivazione UOPI</h3>
            <form id="deactivateUopiForm">
                <div class="form-group">
                    <label class="form-label">Operatori in Rientro:</label>
                    <textarea class="form-input" name="operatori" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Ora Disattivazione:</label>
                    <input type="datetime-local" class="form-input" name="ora" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Note:</label>
                    <textarea class="form-input" name="note" rows="3"></textarea>
                </div>
            </form>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Annulla</button>
                <button class="btn" onclick="saveModule('deactivateUopi')">Disattiva</button>
            </div>
        </div>
    </div>

    <!-- Modal Request Activation -->
    <div id="modalRequestActivation" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">üìã Istanza Attivazione</h3>
            <form id="requestActivationForm">
                <div class="form-group">
                    <label class="form-label">Tipo Rapina:</label>
                    <select class="form-input" name="tipo" required>
                        <option value="">Seleziona</option>
                        <option value="Rapina armata">Rapina a mano armata</option>
                        <option value="Rapina banca">Rapina in banca</option>
                        <option value="Altro">Altro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Operatore Responsabile:</label>
                    <input type="text" class="form-input" name="responsabile" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Operatori Disponibili:</label>
                    <textarea class="form-input" name="operatori" placeholder="Tonino Frasca, Gabriel Martinelli..." rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Urgenza:</label>
                    <select class="form-input" name="urgenza" required>
                        <option value="ALTA">ALTA - Immediata</option>
                        <option value="MEDIA">MEDIA - 30 min</option>
                        <option value="BASSA">BASSA - Programmata</option>
                    </select>
                </div>
            </form>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Annulla</button>
                <button class="btn" onclick="saveModule('requestActivation')">Invia</button>
            </div>
        </div>
    </div>

    <script>
        // Database
        let db = JSON.parse(localStorage.getItem('uopiDB')) || {
            operators: [],
            modules: []
        };

        // Login
        document.getElementById('loginForm').onsubmit = function(e) {
            e.preventDefault();
            let user = document.getElementById('username').value;
            let pass = document.getElementById('password').value;
            
            if (user === 'adminuopi_2847832742398' && pass === 'uopiadmin_82389849298') {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                updateDashboard();
                showNotification('Login riuscito!');
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        };

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.onclick = function() {
                let section = this.dataset.section;
                
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(section).classList.add('active');
                
                let titles = {home: 'Dashboard', operators: 'Operatori', modules: 'Moduli UOPI'};
                document.getElementById('pageTitle').textContent = titles[section];
            };
        });

        // Modal functions
        function openModal(type) {
            let modal = document.getElementById('modal' + type.charAt(0).toUpperCase() + type.slice(1));
            modal.classList.add('active');
            
            if (type === 'deactivateUopi') {
                let now = new Date().toISOString().slice(0, 16);
                modal.querySelector('input[name="ora"]').value = now;
            }
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }

        // Save operator
        function saveOperator() {
            let form = document.getElementById('operatorForm');
            let data = new FormData(form);
            
            let operator = {
                id: Date.now(),
                matricola: 'UOPI-' + (db.operators.length + 1).toString().padStart(4, '0'),
                nome: data.get('nome'),
                cognome: data.get('cognome'),
                grado: data.get('grado'),
                password: Math.random().toString(36).substr(2, 8)
            };
            
            db.operators.push(operator);
            localStorage.setItem('uopiDB', JSON.stringify(db));
            
            closeModal();
            updateOperatorsTable();
            updateDashboard();
            showNotification(`Operatore creato! Matricola: ${operator.matricola}, Password: ${operator.password}`);
        }

        // Save module
        function saveModule(type) {
            let form = document.getElementById(type + 'Form');
            let data = new FormData(form);
            
            if (!form.checkValidity()) {
                alert('Compila tutti i campi obbligatori');
                return;
            }
            
            let module = {
                id: Date.now(),
                type: type,
                timestamp: new Date().toLocaleString('it-IT'),
                data: {}
            };
            
            for (let [key, value] of data.entries()) {
                module.data[key] = value;
            }
            
            db.modules.push(module);
            localStorage.setItem('uopiDB', JSON.stringify(db));
            
            closeModal();
            updateModulesList();
            updateDashboard();
            
            let messages = {
                activateUopi: 'üöÅ UOPI attivato!',
                activatePatrol: 'üöî Pattuglia attivata!',
                deactivateUopi: 'üèÅ UOPI disattivato!',
                requestActivation: 'üìã Istanza inviata!'
            };
            
            showNotification(messages[type]);
        }

        // Update functions
        function updateDashboard() {
            document.getElementById('operatorsCount').textContent = db.operators.length;
            document.getElementById('modulesCount').textContent = db.modules.length;
            updateOperatorsTable();
            updateModulesList();
        }

        function updateOperatorsTable() {
            let tbody = document.getElementById('operatorsTable');
            
            if (db.operators.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nessun operatore</td></tr>';
                return;
            }
            
            tbody.innerHTML = db.operators.map(op => `
                <tr>
                    <td>${op.matricola}</td>
                    <td>${op.nome} ${op.cognome}</td>
                    <td>${op.grado}</td>
                    <td><button class="btn btn-secondary" onclick="deleteOperator(${op.id})" style="padding: 0.25rem 0.5rem;">Elimina</button></td>
                </tr>
            `).join('');
        }

        function updateModulesList() {
            let container = document.getElementById('modulesList');
            
            if (db.modules.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #a0aec0;">Nessun modulo registrato</p>';
                return;
            }
            
            let sorted = [...db.modules].sort((a, b) => b.id - a.id);
            
            container.innerHTML = sorted.map(mod => `
                <div class="form-item">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <strong>${mod.type.toUpperCase()}</strong>
                        <small>ID: ${mod.id}</small>
                    </div>
                    <div style="color: #a0aec0; margin-bottom: 0.5rem;">${mod.timestamp}</div>
                    <div style="font-size: 0.9rem;">
                        ${Object.entries(mod.data).slice(0, 2).map(([k, v]) => 
                            `<span style="background: #718096; padding: 0.2rem 0.5rem; border-radius: 3px; margin-right: 0.5rem;">${k}: ${v}</span>`
                        ).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Delete operator
        function deleteOperator(id) {
            if (confirm('Eliminare questo operatore?')) {
                db.operators = db.operators.filter(op => op.id !== id);
                localStorage.setItem('uopiDB', JSON.stringify(db));
                updateOperatorsTable();
                updateDashboard();
                showNotification('Operatore eliminato');
            }
        }

        // Notification
        function showNotification(message) {
            let notif = document.getElementById('notification');
            notif.textContent = message;
            notif.classList.add('show');
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        // Logout
        function logout() {
            if (confirm('Sicuro di voler uscire?')) {
                location.reload();
            }
        }

        // Close modal on backdrop click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.onclick = function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            };
        });
    </script>
</body>
</html>
